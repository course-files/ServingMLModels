services:
  flask-gunicorn-app:
    image: servingmlmodels-flask-gunicorn-app
    expose:
      - "8000"

  nginx:
    image: servingmlmodels-nginx
    depends_on:
      - flask-gunicorn-app

  # A container used as a lightweight VM for students to practice Linux commands
  # The alternative is to use an actual VM, but that requires more resources
  # and setup time.
  ubuntu-server:
    image: customized-ubuntu-server:1.0
    build:
      context: ./images/ubuntu
      dockerfile: Dockerfile.ubuntu
    environment:
      ROOT_PASSWORD: ${ROOT_PASSWORD}
      STUDENT_PASSWORD: ${STUDENT_PASSWORD}
    hostname: customized-ubuntu-server-smm
    container_name: customized-ubuntu-server-smm
    # Keeps standard input (STDIN) open for the container,
    # even when nothing is actively attached to it.
    # This maintains the interactive session via bash.
    stdin_open: true
    # A TTY provides the terminal interface that makes interactive programs
    # work correctly. Without it, programs that expect terminal features
    # (colors, cursor positioning, line editing) will malfunction.
    tty: true
    ports:
      - 2222:22
    volumes:
      # To store the required data persistently
      - ./container-volumes/ubuntu/home-student:/home/student
